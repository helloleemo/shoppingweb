import{M as $,D as k}from"./DelModal-SS1ss8Kd.js";import{_ as v,o as n,c as d,b as t,F as g,h as y,f as a,v as p,i as P,j as C,a as w,r as _,d as b,t as f}from"./index-CybjTFcM.js";import{P as V}from"./PaginationProduct-D4IVQYzL.js";import"./component-functions-CUoJew-O.js";const U={props:{product:{type:Object,default(){return{}}}},watch:{product(){this.tempProduct=this.product}},data(){return{modal:{},tempProduct:{}}},methods:{showModal(){this.modal.show()},hideModal(){this.modal.hide()},uploadFile(){const l=this.$refs.fileInput.files[0],e=new FormData;e.append("file-to-upload",l);const i=`${import.meta.VITE_PATH_API}api/${import.meta.VITE_PATH_APP}/admin/upload`;this.$http.post(i,e).then(u=>{u.data.success&&(this.tempProduct.imageUrl=u.data.imageUrl)})}},mounted(){this.modal=new $(this.$refs.modal)}},D={ref:"modal",class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},F={class:"modal-dialog modal-xl",role:"document"},L={class:"modal-content border-0"},I=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"新增產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),N={class:"modal-body"},T={class:"row"},A={class:"col-sm-4"},E=t("div",{class:"mb-3"},[t("label",{for:"image",class:"form-label"},"輸入圖片網址"),t("input",{type:"text",class:"form-control",id:"image",placeholder:"請輸入圖片連結"})],-1),j={class:"mb-3"},B=t("label",{for:"customFile",class:"form-label"},[w("或 上傳圖片 "),t("i",{class:"fas fa-spinner fa-spin"})],-1),H=["src"],O={key:0,class:"mt-5"},S=["onUpdate:modelValue"],q=["onClick"],z={key:0},G={class:"col-sm-8"},J={class:"mb-3"},K=t("label",{for:"title",class:"form-label"},"標題",-1),Q={class:"row gx-2"},R={class:"mb-3 col-md-6"},W=t("label",{for:"category",class:"form-label"},"分類",-1),X={class:"mb-3 col-md-6"},Y=t("label",{for:"price",class:"form-label"},"單位",-1),Z={class:"row gx-2"},tt={class:"mb-3 col-md-6"},et=t("label",{for:"origin_price",class:"form-label"},"原價",-1),ot={class:"mb-3 col-md-6"},st=t("label",{for:"price",class:"form-label"},"售價",-1),lt=t("hr",null,null,-1),it={class:"mb-3"},nt=t("label",{for:"description",class:"form-label"},"產品描述",-1),dt={class:"mb-3"},ct=t("label",{for:"content",class:"form-label"},"說明內容",-1),at={class:"mb-3"},rt={class:"form-check"},pt=t("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),ut={class:"modal-footer"},mt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ht(l,e,i,u,o,c){return n(),d("div",D,[t("div",F,[t("div",L,[I,t("div",N,[t("div",T,[t("div",A,[E,t("div",j,[B,t("input",{type:"file",id:"customFile",class:"form-control",ref:"fileInput",onChange:e[0]||(e[0]=(...s)=>c.uploadFile&&c.uploadFile(...s))},null,544)]),t("img",{class:"img-fluid",src:o.tempProduct.imageUrl,alt:""},null,8,H),o.tempProduct.images?(n(),d("div",O,[(n(!0),d(g,null,y(o.tempProduct.images,(s,m)=>(n(),d("div",{class:"mb-3 input-group",key:m},[a(t("input",{type:"url",class:"form-control form-control","onUpdate:modelValue":h=>o.tempProduct.images[m]=h,placeholder:"請輸入連結"},null,8,S),[[p,o.tempProduct.images[m]]]),t("button",{type:"button",class:"btn btn-outline-danger",onClick:h=>o.tempProduct.images.splice(m,1)}," 移除 ",8,q)]))),128)),o.tempProduct.images[o.tempProduct.images.length-1]||!o.tempProduct.images.length?(n(),d("div",z,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[1]||(e[1]=s=>o.tempProduct.images.push(""))}," 新增圖片 ")])):P("",!0)])):P("",!0)]),t("div",G,[t("div",J,[K,a(t("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[2]||(e[2]=s=>o.tempProduct.title=s),placeholder:"請輸入標題"},null,512),[[p,o.tempProduct.title]])]),t("div",Q,[t("div",R,[W,a(t("input",{type:"text",class:"form-control",id:"category","onUpdate:modelValue":e[3]||(e[3]=s=>o.tempProduct.category=s),placeholder:"請輸入分類"},null,512),[[p,o.tempProduct.category]])]),t("div",X,[Y,a(t("input",{type:"text",class:"form-control",id:"unit","onUpdate:modelValue":e[4]||(e[4]=s=>o.tempProduct.unit=s),placeholder:"請輸入單位"},null,512),[[p,o.tempProduct.unit]])])]),t("div",Z,[t("div",tt,[et,a(t("input",{type:"number",class:"form-control",id:"origin_price","onUpdate:modelValue":e[5]||(e[5]=s=>o.tempProduct.origin_price=s),placeholder:"請輸入原價"},null,512),[[p,o.tempProduct.origin_price,void 0,{number:!0}]])]),t("div",ot,[st,a(t("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":e[6]||(e[6]=s=>o.tempProduct.price=s),placeholder:"請輸入售價"},null,512),[[p,o.tempProduct.price,void 0,{number:!0}]])])]),lt,t("div",it,[nt,a(t("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":e[7]||(e[7]=s=>o.tempProduct.description=s),placeholder:"請輸入產品描述"},null,512),[[p,o.tempProduct.description]])]),t("div",dt,[ct,a(t("textarea",{type:"text",class:"form-control",id:"content","onUpdate:modelValue":e[8]||(e[8]=s=>o.tempProduct.content=s),placeholder:"請輸入產品說明內容"},null,512),[[p,o.tempProduct.content]])]),t("div",at,[t("div",rt,[a(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=s=>o.tempProduct.is_enabled=s),"true-value":1,"false-value":0,id:"is_enabled"},null,512),[[C,o.tempProduct.is_enabled]]),pt])])])])]),t("div",ut,[mt,t("button",{onClick:e[10]||(e[10]=s=>l.$emit("update-product",o.tempProduct)),type:"button",class:"btn btn-primary"}," 確認 ")])])])],512)}const _t=v(U,[["render",ht]]),bt={components:{ProductModal:_t,DelModal:k,Pagination:V},data(){return{products:[],pagination:{},tempProduct:{},isNew:!1,isLoading:!1}},inject:["emitter"],methods:{getProducts(l=1){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/leemotseng-api/admin/products/?page=${l}`;this.$http.get(e).then(i=>{this.isLoading=!1,i.data.success&&(console.log(i.data),this.products=i.data.products,this.pagination=i.data.pagination)})},openModal(l,e){l?this.tempProduct={}:this.tempProduct={...e},this.isNew=l,this.$refs.productModal.showModal()},updateProduct(l){this.tempProduct=l;let e="https://vue3-course-api.hexschool.io/api/leemotseng-api/admin/product",i="post";this.isNew||(e=`https://vue3-course-api.hexschool.io/api/leemotseng-api/admin/product/${l.id}`,i="put");const u=this.$refs.productModal;this.$http[i](e,{data:this.tempProduct}).then(o=>{console.log(o),u.hideModal(),o.data.success?(this.getProducts(),this.emitter.emit("push-message",{style:"success",title:"更新成功"})):this.emitter.emit("push-message",{style:"danger",title:"更新失敗",content:o.data.message.join("、")})})},openDelProductModal(l){this.tempProduct={...l},this.$refs.delModal.showModal()},delProduct(){const l=`https://vue3-course-api.hexschool.io/api/leemotseng-api/admin/product/${this.tempProduct.id}`;this.$http.delete(l).then(e=>{console.log(e.data),this.$refs.delModal.hideModal(),this.getProducts()})}},created(){this.getProducts()}},ft={class:"container"},gt=t("h3",{class:"text-start pt-3"},"產品管理",-1),Pt={class:"text-start"},vt={class:"table mt-4"},yt=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{class:"text-center",width:"120"},"價格"),t("th",{class:"text-center",width:"100"},"啟用狀態"),t("th",{class:"text-center",width:"200"},"編輯")])],-1),xt={class:"text-center"},Mt={class:"text-center"},$t={key:0,class:"text-success"},kt=t("i",{class:"bi bi-circle-fill small"},null,-1),Ct=[kt],wt={key:1,style:{color:"#adb5bd"}},Vt=t("i",{class:"bi bi-circle-fill small"},null,-1),Ut=[Vt],Dt={class:"text-center"},Ft={class:"btn-group"},Lt=["onClick"],It=t("i",{class:"bi bi-pencil"},null,-1),Nt=[It],Tt=["onClick"],At=t("i",{class:"bi bi-trash3"},null,-1),Et=[At];function jt(l,e,i,u,o,c){const s=_("LoadingPage"),m=_("Pagination"),h=_("ProductModal"),x=_("DelModal");return n(),d(g,null,[b(s,{active:o.isLoading},null,8,["active"]),t("div",ft,[gt,t("div",Pt,[t("button",{onClick:e[0]||(e[0]=r=>c.openModal(!0)),class:"btn btn-outline-primary mt-2",type:"button"}," + 新增 ")]),t("table",vt,[yt,t("tbody",null,[(n(!0),d(g,null,y(o.products,r=>(n(),d("tr",{key:r.id},[t("td",null,f(r.category),1),t("td",null,f(r.title),1),t("td",xt,f(l.$filters.currency(r.price)),1),t("td",Mt,[r.is_enabled?(n(),d("span",$t,Ct)):(n(),d("span",wt,Ut))]),t("td",Dt,[t("div",Ft,[t("button",{onClick:M=>c.openModal(!1,r),class:"btn btn-outline-primary btn-sm"},Nt,8,Lt),t("button",{class:"btn btn-outline-danger btn-sm",onClick:M=>c.openDelProductModal(r)},Et,8,Tt)])])]))),128))])]),b(m,{pages:o.pagination,onEmitPages:c.getProducts},null,8,["pages","onEmitPages"]),b(h,{ref:"productModal",product:o.tempProduct,onUpdateProduct:c.updateProduct},null,8,["product","onUpdateProduct"])]),b(x,{item:o.tempProduct,ref:"delModal",onDelItem:c.delProduct},null,8,["item","onDelItem"])],64)}const qt=v(bt,[["render",jt]]);export{qt as default};
